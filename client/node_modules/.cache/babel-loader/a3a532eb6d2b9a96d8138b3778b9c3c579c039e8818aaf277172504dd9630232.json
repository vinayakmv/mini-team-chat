{"ast":null,"code":"var _jsxFileName = \"C:\\\\Welcome 2025\\\\mini-team-chat\\\\client\\\\src\\\\pages\\\\Chat.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport API from \"../api\";\nimport { socket } from \"../socket\";\nimport MessageList from \"../components/MessageList\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat(_ref) {\n  _s();\n  let {\n    user\n  } = _ref;\n  const {\n    channelId\n  } = useParams();\n  const [messages, setMessages] = useState([]);\n  const [text, setText] = useState(\"\");\n  const [hasMore, setHasMore] = useState(true);\n  const pageRef = useRef(1);\n  useEffect(() => {\n    if (!channelId) return;\n    socket.emit(\"joinChannel\", channelId);\n    loadMessages(1);\n    socket.on(\"newMessage\", msg => {\n      if (msg.channel === channelId) setMessages(prev => [...prev, msg]);\n    });\n    return () => {\n      socket.emit(\"leaveChannel\", channelId);\n      socket.off(\"newMessage\");\n    };\n  }, [channelId]);\n  const loadMessages = async function () {\n    let p = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    try {\n      const {\n        data\n      } = await API.get(\"/messages/\".concat(channelId, \"?page=\").concat(p, \"&limit=30\"));\n      if (data.length < 30) setHasMore(false);\n      if (p === 1) setMessages(data);else setMessages(prev => [...data, ...prev]);\n      pageRef.current = p;\n    } catch (err) {\n      console.error(err);\n    }\n  };\n  const send = () => {\n    if (!text.trim()) return;\n    const payload = {\n      channel: channelId,\n      sender: user._id || user.id,\n      text\n    };\n    // server expects message object with channel field name `channel`\n    socket.emit(\"sendMessage\", payload);\n    setText(\"\");\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      style: {\n        alignItems: 'stretch'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"sidebar\",\n        style: {\n          width: 220\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"brand\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"logo\",\n            children: \"C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 51,\n            columnNumber: 34\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Channel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 51,\n              columnNumber: 68\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 51,\n            columnNumber: 63\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 51,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"main\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Channel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 56,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sub\",\n            children: \"Realtime chat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 57,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'column',\n            height: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              padding: '10px 0'\n            },\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn\",\n              disabled: !hasMore,\n              onClick: () => loadMessages(pageRef.current + 1),\n              children: \"Load older\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 62,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 61,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"messages\",\n            children: /*#__PURE__*/_jsxDEV(MessageList, {\n              messages: messages\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 66,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 65,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"composer\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input\",\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                value: text,\n                onChange: e => setText(e.target.value),\n                placeholder: \"Type a message...\",\n                onKeyDown: e => {\n                  if (e.key === 'Enter') send();\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 71,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 70,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"send-btn\",\n              onClick: send,\n              children: \"Send\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 73,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 54,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 48,\n    columnNumber: 5\n  }, this);\n}\n_s(Chat, \"ZDfyyrls9xw6Ek8nf7mzZJSAvao=\", false, function () {\n  return [useParams];\n});\n_c = Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","API","socket","MessageList","jsxDEV","_jsxDEV","Chat","_ref","_s","user","channelId","messages","setMessages","text","setText","hasMore","setHasMore","pageRef","emit","loadMessages","on","msg","channel","prev","off","p","arguments","length","undefined","data","get","concat","current","err","console","error","send","trim","payload","sender","_id","id","className","children","style","alignItems","width","fileName","_jsxFileName","lineNumber","columnNumber","display","flexDirection","height","padding","disabled","onClick","value","onChange","e","target","placeholder","onKeyDown","key","_c","$RefreshReg$"],"sources":["C:/Welcome 2025/mini-team-chat/client/src/pages/Chat.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\nimport { socket } from \"../socket\";\r\nimport MessageList from \"../components/MessageList\";\r\n\r\nexport default function Chat({ user }) {\r\n  const { channelId } = useParams();\r\n  const [messages, setMessages] = useState([]);\r\n  const [text, setText] = useState(\"\");\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const pageRef = useRef(1);\r\n\r\n  useEffect(() => {\r\n    if (!channelId) return;\r\n    socket.emit(\"joinChannel\", channelId);\r\n    loadMessages(1);\r\n\r\n    socket.on(\"newMessage\", (msg) => {\r\n      if (msg.channel === channelId) setMessages(prev => [...prev, msg]);\r\n    });\r\n\r\n    return () => {\r\n      socket.emit(\"leaveChannel\", channelId);\r\n      socket.off(\"newMessage\");\r\n    };\r\n  }, [channelId]);\r\n\r\n  const loadMessages = async (p=1) => {\r\n    try {\r\n      const { data } = await API.get(`/messages/${channelId}?page=${p}&limit=30`);\r\n      if (data.length < 30) setHasMore(false);\r\n      if (p === 1) setMessages(data);\r\n      else setMessages(prev => [...data, ...prev]);\r\n      pageRef.current = p;\r\n    } catch (err) { console.error(err); }\r\n  };\r\n\r\n  const send = () => {\r\n    if (!text.trim()) return;\r\n    const payload = { channel: channelId, sender: user._id || user.id, text };\r\n    // server expects message object with channel field name `channel`\r\n    socket.emit(\"sendMessage\", payload);\r\n    setText(\"\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"app\">\r\n      <div className=\"container\" style={{alignItems:'stretch'}}>\r\n        <aside className=\"sidebar\" style={{width:220}}>\r\n          <div className=\"brand\"><div className=\"logo\">C</div><div><h3>Channel</h3></div></div>\r\n        </aside>\r\n\r\n        <main className=\"main\">\r\n          <div className=\"header\">\r\n            <h2>Channel</h2>\r\n            <div className=\"sub\">Realtime chat</div>\r\n          </div>\r\n\r\n          <div style={{display:'flex',flexDirection:'column',height:'100%'}}>\r\n            <div style={{padding:'10px 0'}}>\r\n              <button className=\"btn\" disabled={!hasMore} onClick={()=>loadMessages(pageRef.current + 1)}>Load older</button>\r\n            </div>\r\n\r\n            <div className=\"messages\">\r\n              <MessageList messages={messages} />\r\n            </div>\r\n\r\n            <div className=\"composer\">\r\n              <div className=\"input\">\r\n                <input value={text} onChange={e=>setText(e.target.value)} placeholder=\"Type a message...\" onKeyDown={(e)=>{ if(e.key==='Enter') send(); }} />\r\n              </div>\r\n              <button className=\"send-btn\" onClick={send}>Send</button>\r\n            </div>\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}